@page
@using System.Security.Claims
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4">This is my CV Web App!</h1>

    <div class="mb-4">
        Zalogowany ID: @User.FindFirst(ClaimTypes.NameIdentifier)?.Value<br />
        Name: @User.FindFirst(ClaimTypes.Name)?.Value<br />
        Provider: @User.FindFirst("idp")?.Value
    </div>

    <p>Learn about <a href="https://learn.microsoft.com/aspnet/core">ASP.NET Core</a>.</p>
</div>

<!-- NOWY FORMULARZ DODAJ NOTATKĘ -->
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-plus"></i> Dodaj nową notatkę</h4>
                </div>
                <div class="card-body">
                    <form method="post" asp-page-handler="Create">
                        <div class="mb-3">
                            <label asp-for="NewNote.Title" class="form-label">Tytuł</label>
                            <input asp-for="NewNote.Title" class="form-control" placeholder="Wpisz tytuł..." />
                            <span asp-validation-for="NewNote.Title" class="text-danger"></span>
                        </div>
                        
                        <div class="mb-3">
                            <label asp-for="NewNote.Description" class="form-label">Opis</label>
                            <textarea asp-for="NewNote.Description" class="form-control" rows="3" placeholder="Wpisz opis..."></textarea>
                            <span asp-validation-for="NewNote.Description" class="text-danger"></span>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Zapisz notatkę
                        </button>
                        <a href="#" class="btn btn-secondary ms-2" onclick="document.querySelector('form').reset(); return false;">
                            Wyczyść
                        </a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(Model.Message))
{
    <div class="alert alert-success alert-dismissible fade show mt-3 mx-auto" style="max-width: 600px;" role="alert">
        @Model.Message
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Auto-wyczyść po sukcesie
        @if (!string.IsNullOrEmpty(Model.Message))
        {
            <text>
                setTimeout(() => {
                    document.querySelector('.alert').style.transition = 'opacity 0.5s';
                    document.querySelector('.alert').style.opacity = '0';
                    setTimeout(() => document.querySelector('.alert').remove(), 500);
                }, 3000);
            </text>
        }
    </script>
}
